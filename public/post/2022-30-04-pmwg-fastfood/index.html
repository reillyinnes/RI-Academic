<!DOCTYPE html><html lang="en-us" >

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  
  
  <meta name="generator" content="Wowchemy 4.8.0 for Hugo">
  

  

  
  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Reilly Innes">

  
  
  
    
  
  <meta name="description" content="This blog post uses the pmwg package for a more generic example than has previously been shown (here for example).
PMwG The particle metropolis within Gibbs sampling package (pmwg) was created by a team at the University of Newcastle.">

  
  <link rel="alternate" hreflang="en-us" href="/post/2022-30-04-pmwg-fastfood/">

  







  




  
  
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  

  
  
  
  <meta name="theme-color" content="#2962ff">
  

  
  

  
  
  
  
    
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha256-FMvZuGapsJLjouA6k7Eo2lusoAX9i0ShlWFG6qt7SLc=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.2.2/lazysizes.min.js" integrity="sha512-TmDwFLhg3UA4ZG0Eb4MIyT1O1Mb+Oww5kFG0uHqXsdbyZz9DcvYQhKpGgNkamAI6h2lGGZq2X8ftOJvF/XjTUg==" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      
        
      

      
    
      

      
      

      
    
      

      
      

      
    

  

  
  
  
    
      
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
    
  

  
  
  
  
  <link rel="stylesheet" href="/css/wowchemy.css">

  




  


  
  

  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hu1dc3f56a72840a79504e5212c1d5c006_23068_32x32_fill_lanczos_center_3.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hu1dc3f56a72840a79504e5212c1d5c006_23068_192x192_fill_lanczos_center_3.png">

  <link rel="canonical" href="/post/2022-30-04-pmwg-fastfood/">

  
  
  
  
  
  
  
    
    
  
  
  <meta property="twitter:card" content="summary">
  
  <meta property="twitter:site" content="@ReillyInnes">
  <meta property="twitter:creator" content="@ReillyInnes">
  
  <meta property="og:site_name" content="Reilly Innes">
  <meta property="og:url" content="/post/2022-30-04-pmwg-fastfood/">
  <meta property="og:title" content="Using PMwG for NOT psychology | Reilly Innes">
  <meta property="og:description" content="This blog post uses the pmwg package for a more generic example than has previously been shown (here for example).
PMwG The particle metropolis within Gibbs sampling package (pmwg) was created by a team at the University of Newcastle."><meta property="og:image" content="/images/icon_hu1dc3f56a72840a79504e5212c1d5c006_23068_512x512_fill_lanczos_center_3.png">
  <meta property="twitter:image" content="/images/icon_hu1dc3f56a72840a79504e5212c1d5c006_23068_512x512_fill_lanczos_center_3.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2022-04-30T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2022-04-30T00:00:00&#43;00:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/2022-30-04-pmwg-fastfood/"
  },
  "headline": "Using PMwG for NOT psychology",
  
  "datePublished": "2022-04-30T00:00:00Z",
  "dateModified": "2022-04-30T00:00:00Z",
  
  "author": {
    "@type": "Person",
    "name": "Reilly Innes"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "Reilly Innes",
    "logo": {
      "@type": "ImageObject",
      "url": "/images/icon_hu1dc3f56a72840a79504e5212c1d5c006_23068_192x192_fill_lanczos_center_3.png"
    }
  },
  "description": "This blog post uses the pmwg package for a more generic example than has previously been shown (here for example).\nPMwG The particle metropolis within Gibbs sampling package (pmwg) was created by a team at the University of Newcastle."
}
</script>

  

  


  


  





  <title>Using PMwG for NOT psychology | Reilly Innes</title>

</head>


<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" class=" ">

  
  
  
    <script>window.wcDarkLightEnabled = true;</script>
  
  
    <script>const isSiteThemeDark = false;</script>
  
  
  <script src="/js/load-theme.js"></script>

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search" class="form-control">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  












<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#hero"><span>Home</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link  active" href="/post/"><span>Blogs</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/publication/"><span>Publications</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/talk"><span>Talks and Presentations</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/project/"><span>Code</span></a>
        </li>

        
        

        

        
        
        
          
            
          
        

        

        
        
        
        

        
          
            
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="https://osf.io/pf5td/" target="_blank" rel="noopener"><span>OSF</span></a>
        </li>

        
        

        

        
        
        
          
        

        

        
        
        
        

        
          
            
            
          
          
            
            
            
              
            
            
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#contact"><span>Contact</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      
      

      

    </ul>

  </div>
</nav>



  <article class="article">

  












  

  
  
  
<div class="article-container pt-3">
  <h1>Using PMwG for NOT psychology</h1>

  

  
    


<div class="article-metadata">

  
  

  
  <span class="article-date">
    
    
      
    
    Apr 30, 2022
  </span>
  

  

  
  <span class="middot-divider"></span>
  <span class="article-reading-time">
    19 min read
  </span>
  

  
  
  

  
  
  <span class="middot-divider"></span>
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/category/r/">R</a></span>
  

</div>

    














  
</div>



  <div class="article-container">

    <div class="article-style">
      
<script src="/post/2022-30-04-pmwg-fastfood/index_files/header-attrs/header-attrs.js"></script>


<p>This blog post uses the <code>pmwg</code> package for a more generic example than has previously been shown (<a href="https://newcastlecl.github.io/samplerDoc/">here</a> for example).</p>
<!-- more -->
<div id="pmwg" class="section level1">
<h1>PMwG</h1>
<p>The particle metropolis within Gibbs sampling package (<code>pmwg</code>) was created by a team at the University of Newcastle. The package provides functions to estimate Bayesian hierarchical models. What this means is;</p>
<ul>
<li><p>Bayesian; probability based, sampling parameters to form a distribution of parameter values, not a point estimate. Gives us <em>uncertainty</em></p></li>
<li><p>hierarchical; multi levels - i.e., a group level and a subject level. Think of a school (the group mean) and classes within the school (each with their own mean)</p></li>
<li><p>model-based sampling; propose lots of values for model parameters and find those which are probabilistically most liekly</p></li>
</ul>
<p>So far, the package has mainly been used for psychological applications, where lots of data is collected per subject, and this data is then fit with complex models (which cannot be fit with standard methods). For an explanation of the full method see our <a href="https://newcastlecl.github.io/samplerDoc/">other documentation</a> or for the full maths, see <a href="https://www.sciencedirect.com/science/article/pii/S0022249620300389">here</a></p>
</div>
<div id="pmwg_new" class="section level1">
<h1>PMwG_new</h1>
<p>Recently, working together with Niek Stevenson, we’ve added functionality to the PMwG package. These are not detailed here, however, I do use a couple of these functions as they are pretty neat and usable. The additional functions can be seen <a href="https://github.com/niekstevenson/pmwg_new">here</a>.</p>
</div>
<div id="why-would-we-use-this" class="section level1">
<h1>Why would we use this?</h1>
<p>Well there’s a few reasons. For this example, using PMwG is probably overkill, but it makes a nice example for other situations where we might have many observations and many individuals. These bigger data problems represent more realistic scenarios, but importantly, we would want to get a sense of the group level parameter distribution, as well as the individual subjects’ data. For example, if we had a school with many classes (say 50), where each class included 50 students, then we could estimate a model for each class, which would inform the group level model.</p>
<p>The reason to use PMwG is when we have difficult estimation problems. Many models do not have analytic solutions, and so model estimation is often used to overcome this. Even with an analytic solution, doing hierarchical modelling can be challenging, which is where PMwG shows more usefulness. We could use <code>optim</code> to find the most likely values for a problem, but this is not reliable and only does calculations at one level (group or individual). Further, we could use another sampler (like stan or jags), however, with PMwG we can achieve greater efficiency, there is no reliance on multiple chains or convergence (due to sampler properties) and we can reliably estimate a more complex group level model – including the multivariate normal we use as default which allows us to estimate parameter correlations. The latter point is particularly useful for models with collinearity between parameters (i.e., as x goes up, so does y). I’ll do a blog in future showing just how bad post-hoc correlations between parameters are, and how PMwG overcomes this.</p>
<p>So that’s a lot of reasons to use this method, but lets summarise quickly.</p>
<ul>
<li>We use PMwG to estimate statistical models (often with no analytic solution).</li>
<li>The models we would estimate are able to have their density calculated/approximated.</li>
<li>The data we model should have many observations (differs depending on model complexity) for a few different individuals (really want at least 20 to inform the group).</li>
<li>PMwG allows us to do <em>hierarchical modelling</em>. This means we have a group and individual level distribution.</li>
<li>PMwG is Bayesian. This means we can evaluate a level of certainty of our parameter estimates for neater inference.</li>
<li>PMwG is reliable and efficient.</li>
<li>PMwG allows us to estimate between parameter correlations.</li>
</ul>
</div>
<div id="the-data" class="section level1">
<h1>The Data</h1>
<p>In the following example, I use the the <code>fastfood</code> dataset from the <code>openintro</code> package. The data includes 515 item menus from 8 different fast food restaurants. Each item has 15 metrics to descirbe the nutritional value. Here we only use the first 11 metrics due to missing data (something I’ll address using PMwG in another blog post).</p>
<pre class="r"><code>library(openintro)
data &lt;- fastfood[,1:13]</code></pre>
</div>
<div id="setup" class="section level1">
<h1>Setup</h1>
<p>First we need to source the pmwg_new code and set up the environment;</p>
<pre class="r"><code>rm(list=ls())

# library(pmwg)
source(&quot;pmwg/variants/standard.R&quot;)
library(mvtnorm)
library(openintro)</code></pre>
<p>Next, we need to clean the data. Here i include a <code>subject</code> column. This is a requirement of the pmwg package - you must include a <code>subject</code> column. Here, the <code>restaurant</code> column is labelled as the subject. This is because I’m going to treat each restaurant as an individual entity, where each food item is an “observation” from their menu.</p>
<p>I also remove the food item label for coding simplicity purposes. Next I’m going to omit any items with missing data, before finally rescaling four metrics for modelling purposes.</p>
<p><strong>NOTE</strong>: These four rescaled metrics don’t need to be normalised, but the values are far greater than the other measures. Here, by dividing them all by 100, I don’t have to set different priors (it’s mainly because I’m being lazy).</p>
<pre class="r"><code>
names(data)[1]&lt;-&quot;subject&quot;
data &lt;- data[c(1,3:13)]
data &lt;- na.omit(data)
data[,c(2,3,7,8)]&lt;- data[,c(2,3,7,8)]/100</code></pre>
<p>Here, we don’t have many observations, which makes it hard to estimate. We also probably should have more restaurants, but this serves as a nice intro example</p>
</div>
<div id="likelihood-function" class="section level1">
<h1>Likelihood Function</h1>
<p>The likelihood function is the engine in PMwG. The nicest part of this engine, is that you can craft it yourself, giving lots of flexibility. The likelihood function takes the proposed parameters and calculates the likelihood of these given the subjects’ (restaurants) data and the model you’re using.</p>
<p>Before we write this though, we’re first going to check the shapes of the distributions of nutrition metrics.</p>
<pre class="r"><code>
par(mfrow=c(3,4))
apply(data[,-1], 2, hist, main = NULL)</code></pre>
<p><img src="staticunnamed-chunk-4-1.png" width="672" /></p>
<p>Two things are immediately apparent that need to be accounted for in the likelihood. First, all values are greater than 0. Second, we can see that all distributions are positively skewed. We’re going to make sure we do something about these in the likelihood.</p>
<div id="full-function" class="section level2">
<h2>Full Function</h2>
<p>Shown below is the full likelihood function, but I’ll break it down slowly in this section;</p>
<pre class="r"><code>ll &lt;- function(x, data, sample = F ){
  x=exp(x)
  if(sample == FALSE){
    n_pars = length(x)
    tmpData = as.matrix(data[,-1])
    out = sum(TruncatedNormal::dtmvnorm(tmpData, x, diag(1, nrow = n_pars), lb = rep(0,n_pars), log = T, B = 1))
    return(out)
  }else{
    n_pars = length(x)
    Restaurant = data[,1]
    tmpData = as.matrix(data[,-1])
    out = TruncatedNormal::rtmvnorm(nrow(tmpData), x, diag(1, nrow = n_pars), lb = rep(0,n_pars))
    out &lt;- as.data.frame(cbind(out,Restaurant))
    return(out)
  }
  
}</code></pre>
<p>In the likelihood function, we need to include three main arguments;</p>
<ul>
<li><code>x</code> is the vector of proposed (named) parameter values</li>
<li><code>data</code> is the data (note that each time using this will only use data for the one subject being estimated)</li>
<li><code>sample = FALSE</code> is used to specify whether we are sampling from the model (i.e., <code>TRUE</code>) or calculating the density ( <code>FALSE</code> - set as the default)</li>
</ul>
</div>
<div id="transformations" class="section level2">
<h2>Transformations</h2>
<p>The first thing I do in the likelihood is transform the input parameter values. Knowing that all the values in the data are positive, and therefore any proposed parameters will be positive (using a multivariate normal model), I need to ensure that the parameters are also positive.</p>
<p>Taking the exponent of the proposed parameters means these will be strictly positive. This has implications for the implied prior, but I’ll discuss this in the advanced section later on.</p>
</div>
<div id="the-model" class="section level2">
<h2>The Model</h2>
<p>For this example, I was considering using a multivariate normal model, but I found a truncated multivariate normal function that makes it slightly more interesting and accurate (we’ll do some model comparison below too). When thinking about the “model” we’re using, we’re talking about the model of the data describing the data for <strong>each individual</strong>.</p>
<p>Looking at the group level distribution above, we can see a skewed distribution, but it’s worthwhile thinking about this distribution per individual restaurant as well. This means we make the assumption that each individual follows this model, and that informs a population level model (and can allow us to generate or predict other restaurants).</p>
<p>For the truncated multivariate model I use the <code>dtmvnorm</code> and <code>rtmvnorm</code> functions from the <code>TruncatedNormal</code> package for density calculation and random generation respectively.</p>
</div>
<div id="calculating-the-density" class="section level2">
<h2>Calculating the Density</h2>
<p>Here I say that we calculate the likelihood of the data given some parameter values. All I’m doing here is testing the probability of parameters for each persons data. Before I show the functions, I like to do a small thought exercise to show how this works in practice.</p>
<div id="thought-exercise-for-likelihoods" class="section level3">
<h3>Thought exercise for likelihoods</h3>
<p>For this example, let’s generate some data from a normal distribution. Here I make some “parameter” values which I’ll save. These parameters are just mean and standard deviation for the normal.</p>
<pre class="r"><code>truePars = c(&quot;mean&quot;=6,&quot;sd&quot;=.3)
exampleData &lt;- rnorm(n=1000, mean = truePars[&quot;mean&quot;], sd= truePars[&quot;sd&quot;])
</code></pre>
<p>Now, using this data, I’ll try and input some other parameters to see how likely these are for the data;</p>
<pre class="r"><code># first try
sum(dnorm(exampleData,mean=0,sd=1, log = T))
## [1] -18987.53
# a lot off, so lets shift the mean
sum(dnorm(exampleData,mean=7,sd=1, log = T))
## [1] -1457.357
# what if we move the sd
sum(dnorm(exampleData,mean=6,sd=.5, log = T))
## [1] -396.7043
# now lets try them together
sum(dnorm(exampleData,mean=6.5,sd=.3, log = T))
## [1] -1554.667
# very close
sum(dnorm(exampleData,mean=8,sd=.4, log = T))
## [1] -12715.82
# too far
sum(dnorm(exampleData,mean = truePars[&quot;mean&quot;], sd= truePars[&quot;sd&quot;], log = T))
## [1] -189.724
# nice</code></pre>
<p>We can see how the probability increases as we get closer to the <em>generating values</em>. In PMwG, this process is taken care of under the hood. Hopefully this shows just what the algorithm is trying to do. This is also a good test for your model, where likelihood should <em>increase</em> with “better” test values. It’s also a good idea to do simulation and recovery to make sure your model “works”. This means generating values and then fitting the model with the goal of obtaining the generated values. If it doesn’t recover, there could be something wrong with the code, not enough data per condition/individual or the model does not recover.</p>
</div>
<div id="density-function" class="section level3">
<h3>Density function</h3>
<p>The density function is shown below;</p>
<pre class="r"><code>if(sample == FALSE){
    n_pars = length(x)
    tmpData = as.matrix(data[,-1])
    out = sum(TruncatedNormal::dtmvnorm(tmpData, x, diag(1, nrow = n_pars), lb = rep(0,n_pars), log = T, B = 1)) #B=1 because otherwise it does many iterations and takes too long
    return(out)
  }
</code></pre>
<p>There are four steps in the getting the likelihood. First I grab the number of parameters. Second, I remove the names from the data for coding simplicity. Then I do the important part. Finally, I return a single value (the likelihood).</p>
<p>For the important part here, I take the sum of all the densities as they are on the log scale (otherwise I would multiply). Using the <code>dtmvnorm</code> function, I include the data, where each row is an observation and each column is a different metric. The means are given by the parameters (<code>x</code>). I use an sd of 1 for the covariance. I also include a lower bound of 0 for all metrics.</p>
<p>Importantly, all I’m doing here is checking how well the parameters fit the data, just as in the thought exercise above. This means that the density is calculated for each data point (i.e., each observation or food item), and then multiplied together (summed here because I use logs for simplicity).</p>
</div>
</div>
<div id="random-generation" class="section level2">
<h2>Random generation</h2>
<p>In a very similar sense, to generate random data, I use the inverse functionality.</p>
<pre class="r"><code>else{
    n_pars = length(x)
    Restaurant = data[,1] #remove the name column
    tmpData = as.matrix(data[,-1])
    out = TruncatedNormal::rtmvnorm(nrow(tmpData), x, diag(1, nrow = n_pars), lb = rep(0,n_pars))
    out &lt;- as.data.frame(cbind(out,Restaurant)) #add the name column back on
    return(out)
  }
</code></pre>
<p>What this allows us to do is generate data, given some input parameters for a single subject.</p>
</div>
</div>
<div id="pmwg-functions" class="section level1">
<h1>PMwG Functions</h1>
<p>Now I’ve done all the setup, I just need to prepare the sampler. To do this, first we need to specify the vector of parameter names. These will be used by the sampler.</p>
<pre class="r"><code>pars=names(data)[-1]
</code></pre>
<div id="priors" class="section level2">
<h2>Priors</h2>
<p>Next I need to specify some priors. This can be daunting and stressful. But it really doesn’t need to be, especially with PMwG. The prior specification here is for the <strong>group level model</strong>. PMwG assumes that the group level distribution of parameters (i.e., the means for each restaurant - NOT the truncated model) are distributed according to a multivariate normal distribution. For this prior, we only need to set the mean and the variance.</p>
<p>The prior influences which parameter values are proposed. Here, I set the mean to 0 and variance to 10. Mean to 0?? Yes, because proposals come from a range of -Inf to Inf. In our likelihood we take care of these by taking the exponential of them, so really, the mean here is <code>exp(0) = 1</code>. I set the variance to 10 so that a wide range of values are used, but given our exponential transformation, I could probably keep this at 1.</p>
<p>For the rest of PMwG priors, we don’t need to consider the prior shapes of distributions of group level parameters as many researchers stress about with other fitting methods.</p>
<pre class="r"><code>priors &lt;- list(
  theta_mu_mean = rep(0, length(pars)),
  theta_mu_var = diag(rep(10, length(pars)))) 
</code></pre>
</div>
<div id="the-sampler" class="section level2">
<h2>The sampler</h2>
<p>Finally, we can set up the sampler and run the algorithm. To set up the sampler, we use the <code>pmwgs</code> function, where we need to include <code>data</code>,<code>pars</code>,<code>priors</code> and <code>ll_func</code>. Then we can intialise the sampler.</p>
<p>Here, the data must have a subject column so that the data can be split into data for each individual. The pars arguments should include any parameters used in the model to be estimated. Any prior should have a <code>theta_mu_mean</code> vector and a <code>theta_mu_var</code> matrix (mean and variance) of length pars and pars * pars respectively.</p>
<pre class="r"><code># Create the Particle Metropolis within Gibbs sampler object ------------------

sampler &lt;- pmwgs(
  data = data,
  pars = pars,
  prior = priors,
  ll_func = ll
)

sampler &lt;- init(sampler) # i don&#39;t use any start points here</code></pre>
</div>
<div id="sampling" class="section level2">
<h2>Sampling</h2>
<p>When this is done, we can finally do the sampling!! For sampling, there are three stages. The specifics of these can be seen <a href="https://newcastlecl.github.io/samplerDoc/pmwg-sampler-and-signal-detection-theory.html#sdtPMwG">here</a>. the tldr version of this is;</p>
<ul>
<li><code>burn</code> used for initial burn-in samples (the throwaway samples) to get to the posterior distribution</li>
<li><code>adapt</code> used to create the efficient distribution in sampling. This stage will stop if the efficient distribution can be created.</li>
<li><code>sample</code> efficiently sample from the posterior</li>
</ul>
<p>Note that you don’t need to run each stage, you might just run burn-in and throw away the initial samples. However, we’ve seen significant improvements in the quality of samples from the final efficient stage.</p>
<p>For the <code>run_stage</code> argument, we need to include the sampler object, the stage we’re running, the number of iterations, particles and computer cores. For iterations and particles, this could take some fine tuning for the user, however, we tend to use 1000 burn-in iterations, 5000 adaptation and then however many desired samples for the final stage. We generally use either 100 or 300 particles depending on the model complexity. Here I use the <code>pmwg_new</code> function <code>pstar</code>. This adapts the “acceptance rate” - basically making the sampler more efficient. For more info on all the arguments, see <a href="https://newcastlecl.github.io/samplerDoc/pmwg-sampler-and-signal-detection-theory.html#sdtPMwG">here</a>.</p>
<p>In this example, the model is simple and easy to estimate, so I dial back some of these tuning parameters. To know the best settings to use, you might start with something like below and then tinker as you see fit.</p>
<pre class="r"><code>sampled &lt;- run_stage(sampler, stage = &quot;burn&quot;,iter = 100, particles = 100, n_cores = 4, pstar=.6) #epsion will set automatically to 0.5
sampled &lt;- run_stage(sampled, stage = &quot;adapt&quot;,iter = 500, particles = 100, n_cores = 4, pstar=.6) 
sampled &lt;- run_stage(sampled, stage = &quot;sample&quot;,iter = 100, particles = 50, n_cores = 4, pstar=.6) 
</code></pre>
<p>NOTE: This will take a few minutes to run. Increasing the number of particles or iterations will slow the sampler down. However, we need to reach the posterior (i.e., the good values for the parameters), and to do this we need good information. This means that we may need more particles or iterations. Ideally, for efficiency, we should aim for between 30 and 80% acceptance rate. Here, <code>pstar</code> helps as I can specify a desired acceptance rate.</p>
</div>
</div>
<div id="output" class="section level1">
<h1>Output</h1>
<p>Once our sampler is finished, we can check the output.</p>
<div id="checking" class="section level2">
<h2>Checking</h2>
<p>First, we should check that we are in the posterior. To do this, we can check the chain plots of the samples. Here we show two plots. The first is the group level parameter chains and the second is the individual subject likelihood chains. For the parameter chains, we’re looking for “stationarity” in the samples. This means that the sampled values will show a flat line with a bit of wiggle (like a hairy caterpillar). For the subject likelihood, we’re looking for flat lines as well, however, we should see an increase in these from the start to the end. These will be less wiggly. See <a href="https://newcastlecl.github.io/samplerDoc/pmwg-sampler-and-signal-detection-theory.html#check-the-sampling-process">here</a> for more details on this output.</p>
<pre class="r"><code>tmp &lt;- sampled
matplot(t(tmp$samples$theta_mu),type=&quot;l&quot;)</code></pre>
<p><img src="staticunnamed-chunk-15-1.png" width="672" /></p>
<pre class="r"><code>matplot(t(tmp$samples$subj_ll),type=&quot;l&quot;)</code></pre>
<p><img src="staticunnamed-chunk-15-2.png" width="672" /></p>
<p>Here we can see that some parameters only reach the posterior in the final sampling stage (x-axis is iterations of sampling). We can see however, that stationarity is reached. Secondly, we can see that the likelihood increases and then stabilizes at the highest value for each restaurant.</p>
</div>
<div id="posterior-inference" class="section level2">
<h2>Posterior Inference</h2>
<p>Next, we can look at the sampled values. Here I show group level and inidvidual restaurant level parameter values. Remember that by model sampling, we generate distributions of possible parameter values, so here, I take the median of these values. I also transform these as I did in the likelihood.</p>
<pre class="r"><code>groupMedian &lt;- apply(tmp$samples$theta_mu[,tmp$samples$stage==&quot;sample&quot;],1,median)
round(exp(groupMedian),3)
##    calories     cal_fat   total_fat     sat_fat   trans_fat cholesterol 
##       4.842       0.001      23.322       6.782       0.000       0.816 
##      sodium  total_carb       fiber       sugar     protein 
##      12.661      41.485       3.470       6.421      28.770

restaurantMedian &lt;- apply(tmp$samples$alpha[,,tmp$samples$stage==&quot;sample&quot;],1:2, median)
round(exp(restaurantMedian),3)
##             Mcdonalds Chick Fil-A  Sonic  Arbys Burger King Dairy Queen Subway
## calories        5.904       3.870  5.600  4.872       5.672       5.107  4.952
## cal_fat         0.000       0.006  0.000  0.006       0.000       0.003  0.000
## total_fat      31.947      14.475 37.683 26.708      34.755      29.038 18.584
## sat_fat         8.204       3.186 10.982  8.050      10.414      10.415  5.950
## trans_fat       0.000       0.000  0.000  0.004       0.000       0.000  0.002
## cholesterol     1.541       0.596  1.180  0.900       0.884       0.819  0.737
## sodium         14.550      10.735 13.711 15.157      11.673      11.413 12.802
## total_carb     48.858      25.488 47.153 44.797      37.188      38.741 54.857
## fiber           3.394       2.687  2.972  3.022       2.358       3.418  6.606
## sugar          11.041       3.834  6.320  7.477       7.713       6.219 10.094
## protein        40.386      30.841 29.280 29.165      29.285      24.947 30.244
##             Taco Bell
## calories        4.597
## cal_fat         0.000
## total_fat      20.861
## sat_fat         6.409
## trans_fat       0.000
## cholesterol     0.506
## sodium         10.164
## total_carb     46.599
## fiber           5.707
## sugar           3.721
## protein        17.390</code></pre>
<p>We can see the mean values overall, but that’s not overly meaningful. The more meaningful estimates are at the individual level.</p>
<p>We can also look at the distribution of the group parameter values and see how restaurants compare to the group distribution. I’ve only shown two parameters here, but this is a nice example.</p>
<pre class="r fold-hide"><code>library(tidyr)
library(ggplot2)

eg &lt;- apply(tmp$samples$alpha[c(1,10),,tmp$samples$stage==&quot;sample&quot;],1:2, median)
eg&lt;-round(exp(eg),3)
group &lt;- exp(tmp$samples$theta_mu[c(1,10),tmp$samples$stage==&quot;sample&quot;])
group &lt;- as.data.frame(t(group))
eg &lt;- as.data.frame(t(eg))
eg$restaurant &lt;- row.names(eg)
group &lt;- pivot_longer(group, cols = everything(), names_to = &quot;metric&quot;, values_to = &quot;value&quot;)
eg &lt;- pivot_longer(eg, cols = c(&quot;calories&quot;,&quot;sugar&quot;), names_to = &quot;metric&quot;, values_to = &quot;value&quot;)

# add vertical mean line to density plot with geom_vline()
ggplot(group, aes(x=value)) +
  geom_density( fill=&quot;dodgerblue&quot;, alpha=0.5)+
  geom_vline(data=eg,aes(xintercept=value,colour = restaurant), size=.5)+
  geom_text(data=eg,aes(x=value,label = restaurant,y=1), angle=90)+  
  theme_bw()+
  facet_grid(~metric, scales = &quot;free&quot;)</code></pre>
<p><img src="staticunnamed-chunk-17-1.png" width="672" /></p>
<p>Anything unexpected here?</p>
</div>
<div id="correlations" class="section level2">
<h2>Correlations</h2>
<p>Finally, one strength of PMwG is that it assumes a group level multivariate model, with variance given by a covariance matrix. This means we can see correlations between parameters of the model - something that can be very useful with models with multiple components. An example of this is shown below;</p>
<pre class="r"><code>cov&lt;-apply(tmp$samples$theta_var[,,tmp$samples$stage==&quot;sample&quot;],1:2, median)
colnames(cov)&lt;-tmp$par_names
rownames(cov)&lt;-tmp$par_names
cor&lt;-cov2cor(cov) #correlation matrix
library(corrplot)
## corrplot 0.84 loaded
corrplot(cor, method=&quot;circle&quot;, type = &quot;lower&quot;, title = &quot;Parameter Correlations&quot;, tl.col = &quot;black&quot;,mar=c(0,0,2,0))</code></pre>
<p><img src="staticunnamed-chunk-18-1.png" width="672" /></p>
</div>
</div>
<div id="model-comparison" class="section level1">
<h1>Model Comparison</h1>
<p>Let’s say we wanted to compare our model (the truncated normal) to something else (standard multivariate normal). How could we do this??</p>
<p>First, let’s write the likelihood function;</p>
<pre class="r"><code>ll &lt;- function(x, data, sample = F ){
  x=exp(x)
  if(sample == FALSE){
    n_pars = length(x)
    tmpData = as.matrix(data[,-1])
    out = sum(mvtnorm::dmvnorm(tmpData, x, diag(1, nrow = n_pars), log = T)) # only change is here to the model
    return(out)
  }else{
    n_pars = length(x)
    Restaurant = data[,1]
    tmpData = as.matrix(data[,-1])
    out = mvtnorm::rmvnorm(nrow(tmpData), x, diag(1, nrow = n_pars), log = T)
    out &lt;- as.data.frame(cbind(out,Restaurant))
    return(out)
  }
  
}</code></pre>
<p>I ran this model using the exact same code (apart from the likelihood), but I’ve included it below;</p>
<pre class="r fold-hide"><code>rm(list=ls())

# library(pmwg)
setwd(&quot;~/Documents/Research/Amsterdam/Code&quot;)

source(&quot;pmwg/variants/standard.R&quot;)
library(TruncatedNormal)
library(openintro)

data &lt;- fastfood[,1:13]
names(data)[1]&lt;-&quot;subject&quot;
data &lt;- data[c(1,3:13)]
data &lt;- na.omit(data)
data[,c(2,3,7,8)]&lt;- data[,c(2,3,7,8)]/100


## plots

par(mfrow=c(4,3))
apply(data[,-1], 2, hist, main = NULL)
dev.off()


### likelihood
ll &lt;- function(x, data, sample = F ){
  x=exp(x)
  if(sample == FALSE){
    n_pars = length(x)
    tmpData = as.matrix(data[,-1])
    out = sum(mvtnorm::dmvnorm(tmpData, x, diag(1, nrow = n_pars), log = T)) # only change is here to the model
    return(out)
  }else{
    n_pars = length(x)
    Restaurant = data[,1]
    tmpData = as.matrix(data[,-1])
    out = mvtnorm::rmvnorm(nrow(tmpData), x, diag(1, nrow = n_pars), log = T)
    out &lt;- as.data.frame(cbind(out,Restaurant))
    return(out)
  }
  
}

pars=names(data)[-1]


priors &lt;- list(
  theta_mu_mean = rep(0, length(pars)),
  theta_mu_var = diag(rep(10, length(pars)))) 


# Create the Particle Metropolis within Gibbs sampler object ------------------

sampler &lt;- pmwgs(
  data = data,
  pars = pars,
  prior = priors,
  ll_func = ll
)

sampler &lt;- init(sampler) # i don&#39;t use any start points here

sampled &lt;- run_stage(sampler, stage = &quot;burn&quot;,iter = 100, particles = 100, n_cores = 4, pstar=.6) #epsion will set automatically to 0.5
sampled &lt;- run_stage(sampled, stage = &quot;adapt&quot;,iter = 500, particles = 100, n_cores = 4, pstar=.6) 
sampled &lt;- run_stage(sampled, stage = &quot;sample&quot;,iter = 200, particles = 50, n_cores = 4, pstar=.6) 
</code></pre>
<p>Now we have our two sampled objects, we can do model comparison. For some advanced model comparison methods, see <a href="https://newcastlecl.github.io/samplerDoc/estimating-the-marginal-likelihood-via-importance-sampling-is2.html">here</a>. For now though, we’re going to compare using a criterion method. Here, the smaller value represents the more likely model. The function for the deviance information criterion (DIC) is below</p>
<pre class="r fold-hide"><code>pmwg.DIC=function(sampled,pD=FALSE){
  nsubj=length(unique(sampled$data$subject))
  
  # the mean likelihood of the overall (sampled-stage) model, separately for each subject
  mean.like &lt;- apply(sampled$samples$subj_ll[,sampled$samples$stage==&quot;sample&quot;],1,mean)
  
  # the mean of each parameter across iterations. Keep dimensions for parameters and subjects
  mean.params &lt;- t(apply(sampled$samples$alpha[,,sampled$samples$stage==&quot;sample&quot;],1:2,mean))
  
  # i name mean.params here so it can be used by the log_like function
  colnames(mean.params)&lt;-sampled$par_names
  
  # log-likelihood for each subject using their mean parameter vector
  mean.params.like &lt;- numeric(ncol(mean.params))
  data &lt;- transform(sampled$data, subject=match(subject, unique(subject)))
  for (j in 1:nsubj) {
    mean.params.like[j] &lt;- sampled$ll_func(mean.params[j,], data=data[data$subject==j,], sample=FALSE)
  }
  
  # Effective number of parameters
  pD &lt;- sum(-2*mean.like + 2*mean.params.like)
  
  # Deviance Information Criterion
  DIC &lt;- sum(-4*mean.like + 2*mean.params.like)
  
  if (pD){
    return(c(&quot;DIC&quot;=DIC,&quot;effective parameters&quot;=pD))
  }else{
    return(DIC)
  }
    
}
</code></pre>
<p>Now all we need to do is load our two sampled objects and compare!</p>
<pre><code>## Warning in -2 * mean.like + 2 * mean.params.like: longer object length is not a
## multiple of shorter object length
## Warning in -4 * mean.like + 2 * mean.params.like: longer object length is not a
## multiple of shorter object length
##                  DIC effective parameters 
##            1105994.4             231328.4
## Warning in -2 * mean.like + 2 * mean.params.like: longer object length is not a
## multiple of shorter object length

## Warning in -2 * mean.like + 2 * mean.params.like: longer object length is not a
## multiple of shorter object length
##                  DIC effective parameters 
##            1115781.3             231675.7</code></pre>
<pre class="r"><code># First load in the sampled object for the truncated multivariate normal model
load(&quot;fastFood_samples_tmvn.RData&quot;)
# test
pmwg.DIC(sampled) 

# First load in the sampled object for the truncated multivariate normal model
load(&quot;fastFood_samples_mvn.RData&quot;)
# test
pmwg.DIC(sampled)
</code></pre>
<p>Evidently, we can see that the smaller DIC value was for our truncated normal model - so we made a good choice picking this one first ;)</p>
</div>
<div id="final-word" class="section level1">
<h1>Final Word</h1>
<p>In this data set, there are only 8 restaurants. Usually for a hierarchical model, we would want at least 20 individuals. Additionally, there are very few observations per restaurant. Similar to the group level, we want a well informed individual level model. The model still works, but because of the low amount of data, there is greater uncertainty.</p>
<p>So it’s not the best data set, but hey, it makes for a nice example. I’ve also been brief with a few explanations on specifics, the algorithm and some function arguments, but this is for brevity (and because they’re generally not super important). If you want to know more about specifics, please see the <a href="https://newcastlecl.github.io/samplerDoc/">bookdown</a>. Hopefully for users outside of psychology (or even outside of decision making modelling), this example can help contextualize the bookdown.</p>
<p>Happy coding!</p>
<p>Reilly</p>
</div>

    </div>

    






<div class="article-tags">
  
  <a class="badge badge-light" href="/tag/pmwg/">pmwg</a>
  
  <a class="badge badge-light" href="/tag/modelling/">modelling</a>
  
</div>



<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=/post/2022-30-04-pmwg-fastfood/&amp;text=Using%20PMwG%20for%20NOT%20psychology" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/post/2022-30-04-pmwg-fastfood/&amp;t=Using%20PMwG%20for%20NOT%20psychology" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Using%20PMwG%20for%20NOT%20psychology&amp;body=/post/2022-30-04-pmwg-fastfood/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=/post/2022-30-04-pmwg-fastfood/&amp;title=Using%20PMwG%20for%20NOT%20psychology" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="whatsapp://send?text=Using%20PMwG%20for%20NOT%20psychology%20/post/2022-30-04-pmwg-fastfood/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=/post/2022-30-04-pmwg-fastfood/&amp;title=Using%20PMwG%20for%20NOT%20psychology" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>











  
  



  
  
  
    
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <a href="/"><img class="avatar mr-3 avatar-circle" src="/author/reilly-innes/avatar_hu5a4b20d3b4a6508f81c0d01ccc13c00b_4623_270x270_fill_q90_lanczos_center.jpg" alt="Reilly Innes"></a>
    

    <div class="media-body">
      <h5 class="card-title"><a href="/">Reilly Innes</a></h5>
      <h6 class="card-subtitle">Post Doc Researcher</h6>
      <p class="card-text">Researching cognitive workload, computational modelling and decision making.</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
    <li>
      <a href="mailto:reilly.innes@uon.edu.au" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/ReillyInnes" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://scholar.google.com.au/citations?user=navDatAAAAAJ&amp;hl=en&amp;oi=ao" target="_blank" rel="noopener">
        <i class="fas fa-graduation-cap"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/NewcastleCL" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.linkedin.com/in/reilly-innes-638188b6/" target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>


















  </div>
</article>

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.min.js" integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js" integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/latex.min.js"></script>
        
      

    

    
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks",
        'slides' : "Slides"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/wowchemy.min.cd29c13e3da221a8d10c6eec88b953cb.js"></script>

    






  
  
  <div class="container">
    <footer class="site-footer">
  

  <p class="powered-by">
    
  </p>

  
  






  <p class="powered-by">
    
    Published with
    <a href="https://wowchemy.com" target="_blank" rel="noopener">Wowchemy</a>  —
    the free, <a href="https://github.com/wowchemy/wowchemy-hugo-modules" target="_blank" rel="noopener">
    open source</a> website builder that empowers creators.
    

    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
